TY.namespace("ui"),TY.loadedModule("TY.ui.bbsPost"),function(i){var t=function(){return window.bbsGlobal&&"797"==bbsGlobal.item?!0:!1},e=function(i,t){return i.replace(/{(.*?)}/gim,function(i,e){return t[e]?t[e]:i})},n=function(){return window.bbsGlobal&&bbsGlobal.isWeiLun===!0&&bbsGlobal.isSealItem===!0?"weilun":"bbs"};window.TY.ui.bbsPost=function(i){var t=this;TY.loader("TY.util.cursorPoint",function(){t.init(i)})},i.extend(TY.ui.bbsPost.prototype,{position:{},pluginsArray:[],setConfig:function(t){this.el=t.el||null,this.toolWrap=t.toolWrap||null,this.BBSObj=t.BBSObj||null,this.render=t.render||null,this.plugins={};var e=this;this.pluginsInit={friend:{text:"朋友",callback:function(t){TY.loader("TY.ui.friendV2",function(){new TY.ui.friend({textArea:t.find("textarea"),el:i(".editorToolBar",t).find(".friend"),isClickHide:!0,left:-6,top:0,isAutoTip:!1})})}},photo:{text:"图片",callback:function(t){TY.loader("TY.ui.photoV2",function(){var a=e.el.find("textarea");TY.util.cursorPoint.bindCursorPoint(a.get(0)),new TY.ui.photo({wrapContainer:t,el:i(".editorToolBar",t).find(".photo"),uploadPic:{callback:function(i,t){e.insertPhoto(i,t)}},newSociPic:{callback:function(i,t){e.insertPhoto(i,t)}},webPic:{callback:function(i,t){e.insertPhoto(i,t)}},noPreview:!0,app:n(),picNum:50,top:28,left:-68,arrowLeft:80,domain:document.domain})})}},emotion:{text:"表情",callback:function(){}},video:{text:"视频",callback:function(t){TY.loader("TY.ui.videoV2",function(){new TY.ui.video({el:i(".video",i(".editorToolBar",t)),textarea:t.find("textarea"),callback:function(i){e.insertVideo(i)},top:2,left:-195,arrowLeft:210})})}},vote:{text:"投票",callback:function(t){TY.loader("TY.ui.popWrap",function(){e.plugins.vote=new TY.ui.popWrap({el:i(".editorToolBar",t).find(".vote"),content:'<div id="iframeArea_vote" style="overflow:hidden;"></div>',mode:"remove",position:"bottom",top:8,left:-260,arrowLeft:275,isArrow:!0,bodyClick:!0,iframeResize:{name:"iframeArea_vote",path:"http://apps.tianya.cn/vote/forum_vote_page.html?callbackObj="+e.BBSObj+"&fn=pluginCallback&iframeId=iframeArea_vote_Frame&_v="+(new Date).getTime(),width:726,height:600}})})}},gambling:{text:"积分开盘",callback:function(t){return i(".gambling_preview li").size()?(alert("抱歉，一个帖子只能开一个盘！"),!1):void TY.loader("TY.ui.popWrap",function(){e.plugins.gambling=new TY.ui.popWrap({el:i(".editorToolBar",t).find(".gambling"),content:'<div id="iframeArea_gambling"></div>',mode:"remove",position:"bottom",top:8,left:-322,arrowLeft:335,isArrow:!0,bodyClick:!0,iframeResize:{name:"iframeArea_gambling",path:"http://bocai.tianya.cn/gambling/ball/form.jsp?callbackObj="+e.BBSObj+"&fn=pluginCallback&iframeId=iframeArea_gambling_Frame&_v="+(new Date).getTime()+"&betType=0",width:726,height:350}})})}},"gambling-bei":{text:"天涯贝开盘",callback:function(t){return i(".gambling_preview li").size()?(alert("抱歉，一个帖子只能开一个盘！"),!1):void TY.loader("TY.ui.popWrap",function(){e.plugins.gambling=new TY.ui.popWrap({el:i(".editorToolBar",t).find(".gambling"),content:'<div id="iframeArea_gambling"></div>',mode:"remove",position:"bottom",top:8,left:-322,arrowLeft:425,isArrow:!0,bodyClick:!0,iframeResize:{name:"iframeArea_gambling",path:"http://bocai.tianya.cn/gambling/ball/form.jsp?callbackObj="+e.BBSObj+"&fn=pluginCallback&iframeId=iframeArea_gambling_Frame&_v="+(new Date).getTime()+"&betType=1",width:726,height:350}})})}},draft:{text:"草稿箱",callback:function(){}}};var a=t.plugins||"";if(a){var o=a.split(",");if(o.length>0)for(var r=0,l=o.length;l>r;r++)this.pluginsArray.push(o[r]);else this.pluginsArray.push(a)}},init:function(i){this.setConfig(i),this.insertHtml(),this.bindEvent()},insertHtml:function(){var t=this;this.toolWrap.addClass("editorToolBar");for(var e=0,n=this.pluginsArray.length;n>e;e++)this.toolWrap.append("<span class='"+this.pluginsArray[e]+"'>"+this.pluginsInit[this.pluginsArray[e]].text+"</span>"),i("."+this.pluginsArray[e],this.toolWrap).bind("click",function(){t.pluginsInit[this.className].callback(t.el)});i.isFunction(this.render)&&this.render()},insertPhoto:function(i,t){var e,n,a="\n",o=this.el.find("textarea"),r=this;if(r.position=TY.util.cursorPoint.get(o.get(0)),0===+r.position.end&&(r.position.start=o.val().length,r.position.end=o.val().length),n=o.val().substring(0,this.position.end),e=o.val().substring(this.position.end),i){for(var l=0,s=i.length;s>l;l++)a+=t?i[l].big+"\n":i[l].mid+"\n";o.val(n+a+e),TY.util.cursorPoint.toTextAt(o.get(0),o.val().length-e.length)}},insertVideo:function(i){var t,e,n,a=this.el.find("textarea");i&&(e=a.val().substring(0,this.position.end),t=a.val().substring(this.position.end),n="\n"+i.flashUrl+"\n"+i.title+"\n",a.val(e+n+t))},bindEvent:function(){var i=this.el.find("textarea"),e=this;this.toolWrap.find("span").click(function(){e.position=TY.util.cursorPoint.get(i.get(0))}),this.el.find("textarea").bind("click",function(){__global.isOnline()||0!=t()||TY.loginAction()})},createPreview:function(t,n,a){var o,r=i(".ty_bbs_preview_area",this.el),l=i(t,this.twitterPoster);l.size()>0?l.append(e(a,n)):(0==t.indexOf(".")?(o=t.replace(".",""),r.append('<ul class="'+o+'"></ul>')):0==t.indexOf("#")?(o=t.replace("#",""),r.append('<ul id="'+o+'"></ul>')):alert("传入id有误"),i(t,this.twitterPoster).append(e(a,n)))},pluginCallback:function(t,e,n){var a='<li val="{id}"><a href="{url}" target="_blank">{content}</a><a class="fr" href="javascript:(0);" onclick="jQuery(this).parent().remove();return false;">删除</a></li>';switch("undefined"==typeof n&&(n=!0),e){case"vote":this.createPreview(".vote_preview",t,a),this.plugins.vote.remove();break;case"event":i(".act_preview").empty(),this.createPreview(".act_preview",t,a),this.plugins.act.remove();break;case"album":n&&this.plugins.album.remove();break;case"gambling":this.createPreview(".gambling_preview",t,a),this.plugins.gambling.remove()}}})}(jQuery);