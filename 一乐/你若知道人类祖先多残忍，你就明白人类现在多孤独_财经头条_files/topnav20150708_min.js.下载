!function(t){function e(e){var i=this.attr("data-target");if(!i)return;var a=t(document).data(i);if(!a){t(document).data(i,a=new n(this));s.push(i)}(e=="show"||e=="hide")&&a[e](this)}var n=function(t){this.element=t;this.touchNumber=0};n.version="0.0.1";n.prototype={constructor:n,addEvent:function(e){var n=this;e.on("mouseenter",function(){n.preventHide()});e.on("mouseleave",function(){n.hide(t(this))})},show:function(e){this.current=e;if(this.touchNumber<1){this.hideId&&clearTimeout(this.hideId);var n=this,i=e.attr("data-target"),s=t("#"+i),r=t.Event("dropdown.show");if(r.isDefaultPrevented())return;e.trigger(r);e.addClass("cur");s.show();e.trigger({type:"dropdown.shown"});if(!a){if(n.hasAddEvent)return;n.addEvent(s);n.hasAddEvent=!0}a&&n.touchNumber++}else{this.hide();var o=e.attr("href");/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(o)&&window.open(o)}},hide:function(){var e=this,n=this.current.attr("data-target"),i=t("#"+n);this.current.removeClass("cur");this.hideId=setTimeout(function(){e.immediatelyHide(i)},100)},preventHide:function(){this.current.addClass("cur");clearTimeout(this.hideId)},immediatelyHide:function(t){if(t.length){t.hide();this.touchNumber=0}}};var i=t.fn.SMVDropdown;t.fn.SMVDropdown=e;t.fn.SMVDropdown.constructor=n;t.fn.SMVDropdown.noConflict=function(){t.fn.SMVDropdown=i;return this};var s=[],a=/pad|phone|android/i.test(navigator.userAgent);if(a){t(document).on("touchstart","[data-action='dropdown']",function(n){n.preventDefault();n.stopPropagation();t.each(s,function(e,n){t(document).data(n).hide(t(this))});e.call(t(this),"show")});t(document).on("touchstart",function(){setTimeout(function(){t.each(s,function(e,n){t(document).data(n).hide()})},400)})}else{t(document).on("mouseenter","[data-action='dropdown']",function(){e.call(t(this),"show")});t(document).on("mouseleave","[data-action='dropdown']",function(){e.call(t(this),"hide")})}}(jQuery);!function(t){var e=function(t){this.element=t};e.version="0.0.1";e.prototype={constructor:e,setValue:function(){$this=this.element;var e=$this.attr("data-value"),n=$this.find("[data-text]").text(),i=$this.attr("data-group");$target=t("#"+i);$target.attr("data-value",e);$target.find("[data-text]").text(n);t("[data-group="+i+"]").removeClass("cur");$this.addClass("cur");t(document).data($target.attr("data-target")).hide();this.last=$this}};var n=function(){var n=this.attr("data-value"),i=this.attr("data-group");if(n&&i){var s=n+i,a=t(document).data(s);a||t(document).data(s,a=new e(this));a.setValue()}},i=t.fn.SMVSelect;t.fn.SMVSelect=n;t.fn.SMVSelect.constructor=e;t.fn.SMVSelect.noConflict=function(){t.fn.SMVSelect=i;return this};var s=/pad|phone|android/i.test(navigator.userAgent),a=s?"touchstart":"click";t(document).on(a,"[data-action='select']",function(e){e.stopPropagation();n.call(t(this))})}(jQuery);!function(t){t("[data-action='dropdown']").on("dropdwon.shown",function(e){var n=t(this).attr("data-target"),i=t(".sina15-channel-nav").offset().left,s=0,a=t(".sina15-channel-nav").width();t.each(t("#"+n+" li"),function(e,n){s+=t(n).width()});var r=t(this).offset().left+t(this).width()/2-i,o=a-r;r>s/2?o<s/2?t("#"+n+" ul").css({left:a-s}):t("#"+n+" ul").css({left:r-s/2}):t("#"+n+" ul").css({left:0})})}(jQuery);!function(t){var e={init:function(){this.key=t("#nav_search [node=key]");this.getDefaultWord();this.bind()},bind:function(){var t=this;this.key.focus(function(){t.placeHold("focus")});this.key.blur(function(){t.placeHold("blur")})},getDefaultWord:function(){var e=this;t.ajax({url:"http://s.weibo.com/ajax/jsonp/suggestion",data:{Refer:"sina_sug"},dataType:"jsonp",jsonp:"_cb",success:function(t){e.setDefaultWord(t)}})},setDefaultWord:function(t){var e=this.key,n=t.data,i=n[Math.floor(Math.random()*n.length)];e.attr("data-default",i);e.val(i);e.addClass("default")},placeHold:function(e){var n=this.key,i=n.val(),s=n.attr("data-default"),a=t("#nav_search [node=search] i");if(e=="focus"){if(i==s){n.val("");n.removeClass("default");a.addClass("sina15-icon-search1")}}else if(t.trim(i)==""){n.val(s);n.addClass("default");a.removeClass("sina15-icon-search1")}}};e.init()}(jQuery);!function(t){var e=function(t,e){var n=function(){};n.prototype=e.prototype;t.prototype=new n;t.prototype.constructor=t;t.supperClass=e.prototype;e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)},n={submit:t.Callbacks()},i=function(t){this.config=t;this.searParams={url:"http://search.sina.com.cn",qs:{ie:"utf-8",q:"",c:""}};this.init()};i.prototype={init:function(){this.bind()},bind:function(){var t=this,e=this.config;e.key.keydown(function(e){e.keyCode==13&&t.submit()});e.search.click(function(){t.submit()})},submit:function(e){var n,e,i,s,a;a=this.config;e=e||a.key.val();e=t.trim(e);s=this.searParams.qs;s.q=e;s.c=a.option.attr("data-value")||"news";i=t.param(s);if(/pad|phone|android/i.test(navigator.userAgent))window.open(this.searParams.url+"?"+i);else{if(!this._link){var r=this._link=document.createElement("a");r.style.display="none";r.setAttribute("target","_blank");document.body.appendChild(r)}this._link.href=this.searParams.url+"?"+i;this._link.click()}}};var s=function(e){this.config=e;this.keyWord="";this.listCurrent=-1;this.evt={fetch:t.Callbacks()};this.init()};s.prototype={init:function(){this.bind()},bind:function(){var e=this,n=this.config.panel;n.on("mouseover","[node=search_suggest_list]",function(n){e.setCurrent(t(this).index())});n.on("click","[node=search_suggest_list]",function(t){e.submit(this)})},suggest:function(t){var e={Refer:"sina_sug",key:t};this.getData(e,this.renderSuggest)},searching:function(){if(this.hasSearching)this.renderSearching(this.searchingCache[0]);else{var t={Refer:"sina_sug"};this.hasSearching=!0;this.getData(t,this.renderSearching,this.searchingCache=[])}},getData:function(e,n,i){var s=this;t.ajax({url:"http://s.weibo.com/ajax/jsonp/suggestion",data:e,dataType:"jsonp",jsonp:"_cb",success:function(t){n.call(s,t);i&&i.push(t)},error:function(){}})},renderSearching:function(t){var e,n;e=t.data;if(e.length){n=this.createSearchingHtml(e);this.config.panel.html(n);this.show();this.setCurrent(-1)}},createSearchingHtml:function(t){var e="";e+='<div class="sina15-search-first"><a href="#">大家正在搜</a></div><ul class="sina15-search-down">';for(var n=0,i=t.length;n<i;n++)e+='<li node="search_suggest_list" queryWord="'+t[n]+'"><a href="#">'+t[n]+"</a></li>";e+='</ul><div class="sina15-search-last"><a href="http://search.sina.com.cn/?channel=channel" target="_blank">进入搜索首页>></a></div>';return e},renderSuggest:function(t){var e,n;e=t.data;if(e.length){n=this.createSuggestHtml(e);this.config.panel.html(n);this.show();this.setCurrent(-1)}else this.hide()},createSuggestHtml:function(t){var e="";e+='<ul class="sina15-search-down">';for(var n=0,i=t.length;n<i;n++)e+='<li node="search_suggest_list" queryWord="'+t[n]+'"><a href="#">'+t[n]+"</a></li>";e+="</ul>";return e},setCurrent:function(t){var e=this.config.panel.find("[node=search_suggest_list]");(t==-1||this.listCurrent!=-1)&&e.eq(this.listCurrent).removeClass("cur");t!=-1&&e.eq(t).addClass("cur");this.listCurrent=t},getPrevValue:function(){var t=this.prev();this.setCurrent(t);return this.getValue(t)},getNextValue:function(){var t=this.next();this.setCurrent(t);return this.getValue(t)},prev:function(t){var e,n,i;e=this.config.panel.find("[node=search_suggest_list]");n=e.length;this.listCurrent==-1?i=n-1:i=(this.listCurrent+n-1)%n;return i},next:function(t){var e,n;e=this.config.panel.find("[node=search_suggest_list]");this.listCurrent==-1?n=0:n=(this.listCurrent+1)%e.length;return n},getValue:function(t){var e=this.config.panel.find("[node=search_suggest_list]");return e.eq(t).attr("queryWord")},submit:function(e){var i,s;i=t(e).index();s=this.getValue(i);this.config.key.val(s);n.submit.fire(s)},show:function(){this.config.panel.show()},hide:function(){this.config.panel.hide()},hasList:function(){var t=this.config.panel.find("[node=search_suggest_list]");return t.length?!0:!1},getLayer:function(){return this.layer}};var a=function(t){a.supperClass.constructor.apply(this,arguments);this.config=t};e(a,i);fn=a.prototype;fn.init=function(){var t=this;this.suggestPanel=new s(this.config);a.supperClass.init.apply(this,arguments)};fn.bind=function(){var e=this,i=this.config.key;i.keydown(function(t){e.dealKeydown(t)});i.keyup(function(t){e.dealKeyup(t)});i.click(function(t){t.stopPropagation();e.dealClick()});t(document.body).on("click",function(){e.hidePanel()});n.submit.add(function(t){e.submit(t)});a.supperClass.bind.apply(this,arguments)};fn.dealClick=function(){var e=this.config.option.attr("data-value");if(e=="news"||!e)t.trim(this.config.key.val())==""?this.suggestPanel.searching():this.addSearchListen()};fn.dealKeyup=function(e){var n=this.config.option.attr("data-value"),i=this.config.key.val();if(n=="news"||!n)if(t.trim(i)==""){this.suggestPanel.searching();this.cancelListen()}else this.addSearchListenByDel(e)};fn.dealKeydown=function(t){var e=this.config.option.attr("data-value"),n=this.config.key.val();if(e=="news"||!e)t.keyCode==38||t.keyCode==40?this.setValue(t):(this.isCharKey(t)||t.keyCode==8)&&this.addSearchListen()};fn.addSearchListen=function(){var t=this;if(this.isListening)return;this.isListening=!0;this.sId=setInterval(function(){t.search()},200)};fn.addSearchListenByDel=function(e){var n=t.trim(this.config.key.val());e.keyCode==46&&this.searchValue!=n&&this.addSearchListen()};fn.search=function(){var e=t.trim(this.config.key.val());if(e&&this.searchValue!=e){this.suggestPanel.suggest(e);this.searchValue=e}};fn.hidePanel=function(){this.cancelListen();this.suggestPanel.hide()};fn.cancelListen=function(){this.sId&&clearInterval(this.sId);this.searchValue="";this.isListening=!1};fn.setValue=function(t){var e;if(!this.suggestPanel.hasList())return;this.cancelListen();t.keyCode==38?e=this.suggestPanel.getPrevValue():e=this.suggestPanel.getNextValue();this.config.key.val(e);t.preventDefault()};fn.isCharKey=function(t){var e=t.keyCode,n;e>=33&&e<=40||e>=112&&e<=123||e==13||e==8||e==46||e==45||e==27||e==9||e==20||e==91||t.ctrlKey||t.shiftKey||t.altKey?n=!1:n=!0;return n};var r=new a({key:t("#nav_search [node=key]"),option:t("#nav_search [node=option]"),search:t("#nav_search [node=search]"),panel:t("#nav_search [node=panel]")})}(jQuery);